##
# This file is part of the Metasploit Framework and may be subject to
# redistribution and commercial restrictions. Please see the Metasploit
# Framework web site for more information on licensing and terms of use.
# http://metasploit.com/framework/
##

require 'msf/core'

class Metasploit3 < Msf::Auxiliary

	def initialize
		super(
			'Name'         => 'VSploit Red DNS Query Module',
			'Version'      => '$Revision$',
			'Description'  => 'This module queries malware related DNS records.',
			'Author'       => 'MJC',
			'License'      => MSF_LICENSE,
			'References'   =>
				[
					[ 'URL', 'http://www.secureworks.com/research/threats/htran/'],
					[ 'URL', 'http://pastebin.com/yKSQd5Z5']
				]
		)
		register_options(
				[
					OptString.new('DNS_SERVER',[false, "Specifies a DNS Server"]),
					OptInt.new('COUNT', [false, "Number of intervals to loop",1]),
					OptInt.new('DELAY', [false, "Delay in seconds between intervals",3])
				],self.class)
        end

	def run
		@res = Net::DNS::Resolver.new()
		
		domain = ["08elec.purpledaily.com","09back.purpledaily.com","33bees.servebeer.com","3ml.infosupports.com","7cback.afraid.org","a-af.arrowservice.net","aam.businessconsults.net","aar.bigdepression.net","a-bne.arrowservice.net","acli-mail.businessconsults.net","acu.businessconsults.net","adb.businessconsults.net","add.infosupports.com","addr.infosupports.com","admin.arrowservice.net","admin.softsolutionbox.net","adt.businessconsults.net","adtkl.newsonet.net","adtlk.bigish.net","aes.infosupports.com","af.arrowservice.net","afda.businessconsults.net","afw.globalowa.com","agl.softsolutionbox.net","ago.businessconsults.net","agru.qpoe.com","a-if.arrowservice.net","alarm.arrowservice.net","alcan.arrowservice.net","alion.businessconsults.net","amne.purpledaily.com","anglo.arrowservice.net","aol.arrowservice.net","aol.softsolutionbox.net","apa.infosupports.com","apa.newsonet.net","apa.safalife.com","apejack.bigish.net","apekl.newsonet.net","apple.blackcake.net","apple.infosupports.com","aps.bigdepression.net","apss.newsonet.net","ara2.blackcake.net","ara2.infosupports.com","ara.blackcake.net","arainfo.bigdepression.net","arainfo.infosupports.com","ara.infosupports.com","argentinia.faqserv.com","argsafhq.blackberrycluter.com","armi.arrowservice.net","asis.newsonet.net","asiv.softsolutionbox.net","asp.softsolutionbox.net","ass.globalowa.com","astone.newsonet.net","ati2.globalowa.com","ati.arrowservice.net","ati.globalowa.com","att.infosupports.com","ausi.businessconsults.net","avph.earthsolution.org","bab.infosupports.com","back.earthsolution.org","backup.infosupports.com","back.worthhummer.net","bah001.blackcake.net","bah.safalife.com","ball.dnsweb.org","bat.bigdepression.net","bat.blackcake.net","bat.infosupports.com","bbc.blackcake.net","bbh.dnsweb.org","bbs.india-videoer.com","bcc.blackberrycluter.com","bda.arrowservice.net","bee.businessconsults.net","bhbt.newsonet.net","bksy.businessconsults.net","bll.dnsweb.org","blue.infosupports.com","bmms07.bm.ust.hk","bob.dnsweb.org","bobo.buisnessconsults.net","bot.bigdepression.net","bphb.arrowservice.net","bswt.purpledaily.com","built.arrowservice.net","business.chileexe77.com","business.infosupports.com","buyer.arrowservice.net","buz.businessconsults.net","caaid.newsonet.net","cac.bigdepression.net","caci2.infosupports.com","caci.blackcake.net","caci.businessconsults.net","caci.infosupports.com","caci.safalife.com","cacq.bigdepression.net","cac.worthhummer.net","cadfait.softsolutionbox.net","cais.blackcake.net","car1.bigdepression.net","carpgallery.longmusic.com","carvin.infosupports.com","catalog.earthsolution.org","cbc.purpledaily.com","ccb.blackberrycluter.com","ccsukl.purpledaily.com","cdc01.hugesoft.org","cdcd.newsonet.net","cdd.purpledaily.com","center.arrowservice.net","center.infosupports.com","ceros.buisnessconsults.net","chamus.gmailboxes.com","chq.newsonet.net","cib.businessconsults.net","cibuc.blackcake.net","citrix.globalowa.com","climate.newsonet.net","clin.earthsolution.org","cman.blackcake.net","coco.purpledaily.com","cok.purpledaily.com","comfile.softsolutionbox.net","conn.gxdet.com","contact.arrowservice.net","contact.ignorelist.com","contact.purpledaily.com","control.arrowservice.net","control.blackberrycluter.com","cook.globalowa.com","cool.newsonet.net","copierexpert.com","corp.purpledaily.com","count.blackcake.net","cov.arrowservice.net","covclient.arrowservice.net","cow.arrowservice.net","cowboy.bigish.net","crab.arrowservice.net","crazycow.homenet.org","create301.dyndns.info","csba.bigdepression.net","csc.businessconsults.net","csch.infosupports.com","csupp.bigish.net","ctch.earthsolution.org","ctcn.dns2.us","ctcn.purpledaily.com","ctcs.bigdepression.net","ctisk.purpledaily.com","ctx.safalife.com","culture.chileexe77.com","daa.bigdepression.net","date.gmailboxes.com","db.billten.net","dcs.ygto.com","ddbb.gxdet.com","default.arrowservice.net","den.blackcake.net","denel.businessconsults.net","des.blackcake.net","des.infosupports.com","dev.teamattire.com","dfait-kl.worthhummer.net","dgih.dnsweb.org","dias.globalowa.com","dns.chileexe77.com","dnsg.bigdepression.net","dns.issnbgkit.net","doa.bigdepression.net","dod.dnsweb.org","domain.arrowservice.net","dotnet.safalife.com","dove.blackcake.net","down.safalife.com","drs.infosupports.com","drs.safalife.com","dsh.newsonet.net","dsw.blackcake.net","dvid.blackcake.net","dvid.infosupports.com","dvn.newsonet.net","dyn.newsonet.net","dyns.infosupports.com","ecc.bigdepression.net","ecc.safalife.com","eds1.infosupports.com","egcc.bigdepression.net","email.hugesoft.org","engineer2010.mynumber.org","epaserver.toythieves.com","epic.purpledaily.com","epi.newsonet.net","epi.purpledaily.com","epod.businessconsults.net","ever.arrowservice.net","explorer.pcanywhere.net","eye.businessconsults.net","fed.purpledaily.com","ffej.newsonet.net","ffej.purpledaily.com","fher.bigish.net","fher.buisnessconsults.net","fher.businessconsults.net","fhh.purpledaily.com","fim.purpledaily.com","finance.chileexe77.com","fineca.blackberrycluter.com","fineca.newsonet.net","finekl.bigish.net","finekl.purpledaily.com","finekl.worthhummer.net","fine.worthhummer.net","fjod.businessconsults.net","flashingaway.otzo.com","flucare.worthhummer.net","fly.blackcake.net","fmcc.businessconsults.net","fmp.bigish.net","fmp.worthhummer.net","fnem.businessconsults.net","fnpc.arrowservice.net","fnrn.businessconsults.net","free.gmailboxes.com","friends.arrowservice.net","fstl.businessconsults.net","fstl.worthhummer.net","ftp.freespirit.acmetoy.com","ftp.purpledaily.com","ftrj.businessconsults.net","fwb.blackcake.net","fwmo.businessconsults.net","fwmo.newsonet.net","gaca.newsonet.net","gannett.infosupports.com","gatu.arrowservice.net","gayi.blackcake.net","gdaa.ns02.info","gdsp.infosupports.com","gdtm.earthsolution.org","gee.safalife.com","gege.newsonet.net","gg.arrowservice.net","ghma.earthsolution.org","gjjr.newsonet.net","glj.purpledaily.com","global.softsolutionbox.net","glx.newsonet.net","gmail.bigdepression.net","gmail.infosupports.com","green.safalife.com","ground.earthsolution.org","ground.infosupports.com","half.earthsolution.org","half.infosupports.com","happy.arrowservice.net","hapyy2010.lflinkup.net","hav.earthsolution.org","help.purpledaily.com","hill.arrowservice.net","home.arrowservice.net","host.arrowservice.net","host.issnbgkit.net","hotel.safalife.com","house.globalowa.com","house.gmailboxes.com","hpd.newsonet.net","hrsy.newsonet.net","hy.purpledaily.com","hy.worthhummer.net","iabk.newsonet.net","iea.businessconsults.net","imgmobile.anxa.com","index.arrowservice.net","india.arrowservice.net","indian.arrowservice.net","info.bigish.net","info.billten.net","info.businessconsults.net","info.dcfrr.com","info.helpngr.net","info.new-soho.com","info.scitence.net","info.softsolutionbox.net","ins.globalowa.com","ins.purpledaily.com","intel.infosupports.com","inter.earthsolution.org","iri.infosupports.com","iri.worthhummer.net","irs.businessconsults.net","irsg.newsonet.net","iscu.purpledaily.com","iswb.softsolutionbox.net","itau.businessconsults.net","itiupdated.dyndns.info","java.earthsolution.org","jbei.purpledaily.com","jeph.earthsolution.org","jfs.newsonet.net","jhd.newsonet.net","jhd.safalife.com","johnbell.longmusic.com","johntime.myftp.name","jr.blackcake.net","king-kl.newsonet.net","kit.dnsweb.org","kit.infosupports.com","klape.globalowa.com","klati.newsonet.net","klbar.purpledaily.com","klbis.globalowa.com","klbis.purpledaily.com","kl-care.newsonet.net","klecca.newsonet.net","klecca.purpledaily.com","klenvi.purpledaily.com","kl-hqun.newsonet.net","kliee.newsonet.net","kl-knab.newsonet.net","kllhd.globalowa.com","kl-mfa.newsonet.net","klmfat.purpledaily.com","klnrdc.newsonet.net","klnrdc.purpledaily.com","klotp.purpledaily.com","klpiec.newsonet.net","kl-rfc.newsonet.net","kl-rio.newsonet.net","kluscc.newsonet.net","kl-vfw.globalowa.com","klwest.purpledaily.com","kmhl.mrbonus.com","knab.newsonet.net","knews.bigdepression.net","koa.purpledaily.com","ks01.peasoul.com","ksap.peasoul.com","lawste.purpledaily.com","leets.hugesoft.org","lhd.globalowa.com","life.blackcake.net","ln.purpledaily.com","lnz.worthhummer.net","loading.bigish.net","local.dnsweb.org","log.bigdepression.net","login.blackcake.net","login.businessconsults.net","log.infosupports.com","login.safalife.com","log.issnbgkit.net","logs.chileexe77.com","logs.issnbgkit.net","logs.pcclubddk.net","loper.purpledaily.com","love.arrowservice.net","lrl.infosupports.com","lucie.dnsweb.org","lucy2.businessconsults.net","lucy2.infosupports.com","lucy.bigdepression.net","lucy.blackcake.net","lucy.businessconsults.net","lw.purpledaily.com","mail.arrowservice.net","mail.businessconsults.net","mail.chileexe77.com","mail.infosupports.com","mail.new-soho.com","mail.newsonet.net","mail.safalife.com","mailserver.instanthq.com","mailserver.sendsmtp.com","mail.softsolutionbox.net","mailsrv.scitence.net","man001.blackcake.net","man001.infosupports.com","mantech.blackcake.net","max.arrowservice.net","mcsc.buisnessconsults.net","mcsc.businessconsults.net","media.purpledaily.com","merax.newsonet.net","mfa.globalowa.com","mfc.newsonet.net","milk.arrowservice.net","mini.arrowservice.net","mko.busketball.com","mlls.globalowa.com","moiserver.myftp.info","moon.blackcake.net","moon.infosupports.com","mor.newsonet.net","mos.arrowservice.net","mosfdns.ddns.ms","moto.mefound.com","motor.earthsolution.org","mpe.arrowservice.net","na.bigdepression.net","nameless.3322.org","nat.bigdepression.net","nature.arrowservice.net","navi.earthsolution.org","nci.bigdepression.net","nci.dnsweb.org","ncih.dnsweb.org","nci.safalife.com","ncsc.businessconsults.net","ne.hugesoft.org","net.infosupports.com","new.arrowservice.net","new.globalowa.com","newport.bigdepression.net","newport.infosupports.com","newport.safalife.com","news.bigdepression.net","news.billten.net","news.blackcake.net","news.businessconsults.net","news.busketball.com","news.chileexe77.com","news.dnsweb.org","news.india-videoer.com","news.infosupports.com","news.issnbgkit.net","news.pcclubddk.net","news.scitence.net","newsservice.bouncemet.net","news.softsolutionbox.net","ngc.blackcake.net","nhc.newsonet.net","nhs1.newsonet.net","nhsl.newsonet.net","nhs.newsonet.net","nis.purpledaily.com","nousage.arrowservice.net","nrfn.newsonet.net","ns.issnbgkit.net","nsweb.hostent.org","nucor001.purpledaily.com","nuk.purpledaily.com","num.safalife.com","office.lflink.com","officeudpate.servehttp.com","okie.businessconsults.net","oliver.arrowservice.net","onk.newsonet.net","ope.purpledaily.com","oppa.bigdepression.net","opp.infosupports.com","optimizon.com","orca.arrowservice.net","otp.blackberrycluter.com","otps.globalowa.com","ou1.blackcake.net","ou1.infosupports.com","ou2.infosupports.com","ou3.infosupports.com","ou4.infosupports.com","ou5.infosupports.com","ou6.infosupports.com","ou7.infosupports.com","ou.infosupports.com","owa.arrowservice.net","owa.businessconsults.net","owa.softsolutionbox.net","pacific.blackcake.net","pacific.worthhummer.net","paekl.gmailboxes.com","pars.earthsolution.org","part.bigdepression.net","part.earthsolution.org","parth.earthsolution.org","pcie.arrowservice.net","pdoc.earthsolution.org","pear.blackcake.net","pear.infosupports.com","people.softsolutionbox.net","phb.arrowservice.net","picture.chileexe77.com","pizf.peasoul.com","pl0y.peasoul.com","pme.worthhummer.net","pop2.blackcake.net","pop2.infosupports.com","pop3.blackcake.net","pop3.infosupports.com","pop4.blackcake.net","pop5.blackcake.net","pop6.infosupports.com","pop9.infosupports.com","pop.blackcake.net","pop.businessconsults.net","pop.dnsweb.org","pop.infosupports.com","popw.infosupports.com","port.infosupports.com","ppt.arrowservice.net","prc.newsonet.net","priv.dsmtp.com","proc.blackberrycluter.com","proc.purpledaily.com","progress.purpledaily.com","protoc.blackcake.net","protoc.infosupports.com","psu.businessconsults.net","psu.worthhummer.net","qedh.earthsolution.org","qiao1.bigdepression.net","qiao2.bigdepression.net","qiao3.bigdepression.net","qiao4.bigdepression.net","qiao5.bigdepression.net","qiao6.bigdepression.net","qiao7.bigdepression.net","qiao8.bigdepression.net","qua.businessconsults.net","qual.bigdepression.net","quick.earthsolution.org","quiet.earthsolution.org","rcs.purpledaily.com","red.infosupports.com","release.purpledaily.com","release.softsolutionbox.net","research.purpledaily.com","research.softsolutionbox.net","rice.bigish.net","rj.purpledaily.com","roger.buisnessconsults.net","rouji.freespirit.acmetoy.com","rsut.purpledaily.com","safbejn.worthhummer.net","saf.blackberrycluter.com","saf.globalowa.com","sam.blackcake.net","sam.infosupports.com","san.www1.biz","sav.safalife.com","sbh.businessconsults.net","scc.globalowa.com","scc.purpledaily.com","sea001.arrowservice.net","sea.arrowservice.net","search.blackcake.net","send.issnbgkit.net","seoulsummit.ddns.ms","servf.zyns.com","service.arrowservice.net","service.issnbgkit.net","sfn.globalowa.com","shot.buisnessconsults.net","shot.businessconsults.net","sifcc.arrowservice.net","sip.businessconsults.net","sisc.purpledaily.com","sky.safalife.com","sllaw.hugesoft.org","slnoa.hugesoft.org","slnoa.newsonet.net","slrfc.newsonet.net","slrj.softsolutionbox.net","slrouji.infosupports.com","sls.purpledaily.com","slutc.globalowa.com","smooth.newsonet.net","smtp.infosupports.com","smtp.safalife.com","snoopy.safalife.com","snoot.earthsolution.org","soler.buisnessconsults.net","sona.arrowservice.net","songs.longmusic.com","sope.purpledaily.com","sos.businessconsults.net","sotp.purpledaily.com","spah.earthsolution.org","spahi.dnsweb.org","special.earthsolution.org","sports3.earthsolution.org","sports.businessconsults.net","sports.chileexe77.com","spte.bigdepression.net","srs.businessconsults.net","srs.dnsweb.org","srs.infosupports.com","ssa.businessconsults.net","sslsrv1.infosupports.com","sslsrv2.infosupports.com","sslsrv5.infosupports.com","sslsrv6.infosupports.com","ssun.arrowservice.net","stell.purpledaily.com","stk.blackcake.net","stk.infosupports.com","stock.bigish.net","stulaw.bigish.net","stuwal.newsonet.net","sun.arrowservice.net","sunnysaf.allowed.org","sute.newsonet.net","sw.hugesoft.org","sword.bigish.net","syn.arrowservice.net","sys.businessconsults.net","sysinfo.mynumber.org","tape.businessconsults.net","tape.dnsweb.org","tape.purpledaily.com","tclient.arrowservice.net","techniq.whandjg.net","test.chileexe77.com","test.issnbgkit.net","test.newsonet.net","texc.arrowservice.net","think.arrowservice.net","think.purpledaily.com","timeforbeat.ns01.us","time.issnbgkit.net","tod.newsonet.net","train.newsonet.net","tra.softsolutionbox.net","trb.arrowservice.net","trip.arrowservice.net","tx.businessconsults.net","ug-aa.hugesoft.org","ug-aaon.hugesoft.org","ug-aeai.hugesoft.org","ug-ag.hugesoft.org","ug-asg.hugesoft.org","ug-ati.hugesoft.org","ug-bdai.hugesoft.org","ug-bdfa.hugesoft.org","ug-bpd.hugesoft.org","ug-cccc.hugesoft.org","ug-ccr.hugesoft.org","ug-co.hugesoft.org","ug-cono.hugesoft.org","ug-cti.hugesoft.org","ug-dfait.hugesoft.org","ug-enrc.hugesoft.org","ug-ga.hugesoft.org","ug-hst.hugesoft.org","ug-irpf.hugesoft.org","ug-kfc.hugesoft.org","ug-man.hugesoft.org","ug-mbi.hugesoft.org","ug-nema.hugesoft.org","ug-opm.hugesoft.org","ug-piec.hugesoft.org","ug-pmet.hugesoft.org","ug-pnl.hugesoft.org","ug-rev.hugesoft.org","ug-rj.arrowservice.net","ug-rj.hugesoft.org","ug-sbig.hugesoft.org","ug-tree.hugesoft.org","ug-tta.hugesoft.org","ug-volpe.hugesoft.org","unifh.earthsolution.org","update.dnsweb.org","update.safalife.com","up.safalife.com","url.blackcake.net","url.infosupports.com","usc.dnsweb.org","usc.newsonet.net","us.issnbgkit.net","utc.bigdepression.net","utc.dnsweb.org","utex.earthsolution.org","value.arrowservice.net","velp.earthsolution.org","via.blackcake.net","via.infosupports.com","vip.issnbgkit.net","vip.pcclubddk.net","visco.infosupports.com","visual.earthsolution.org","vol.infosupports.com","vop.earthsolution.org","vope.purpledaily.com","vopm.earthsolution.org","vpn.globalowa.com","vpn.softsolutionbox.net","vsec.bigdepression.net","vseh.earthsolution.org","walk.bigish.net","wapi.businessconsults.net","was.arrowservice.net","wcov.businessconsults.net","wdeh.businessconsults.net","weather.chileexe77.com","web.arrowservice.net","web.bigdepression.net","web.infosupports.com","weblog.bigish.net","webmail.arrowservice.net","webmail.blackcake.net","webmail.businessconsults.net","webmail.dcfrr.com","webmail.newsonet.net","webmail.softsolutionbox.net","webmail.whandjg.net","wed5.blackcake.net","wed5.infosupports.com","westkl.blackberrycluter.com","westkl.worthhummer.net","we.trickip.org","wff.businessconsults.net","what.arrowservice.net","wmp.businessconsults.net","wnam.businessconsults.net","wnew.businessconsults.net","wopec.businessconsults.net","workstation.arrowservice.net","world.businessconsults.net","wpcs.businessconsults.net","wpot.arrowservice.net","wpot.businessconsults.net","wpvn.businessconsults.net","wpvn.softsolutionbox.net","wrim.businessconsults.net","wsyggfw.newsonet.net","wwab.purpledaily.com","wwt.blackcake.net","www1.bigdepression.net","www1.earthsolution.org","www1.infosupports.com","www2.bigdepression.net","www2.wikaba.com","www.arrowservice.net","www.blackcake.net","www-conoco.businessconsults.net","www.cpear.ddns.us","www.dnsweb.org","www.freespirit.acmetoy.com","www.globalowa.com","wwwi.earthsolution.org","www.india-videoer.com","www.newsonet.net","www.optimizon.com","www.purpledaily.com","wwwt.infosupports.com","wwww.arrowservice.net","www.worthhummer.net","xawh.earthsolution.org","xmer.businessconsults.net","xtap.newsonet.net","yahoo2.epac.to","yahoo.infosupports.com","yahoo.newsonet.net","yang1.infosupports.com","yang2.infosupports.com","yang2.infosupports.com","yang.bigdepression.net","yang.infosupports.com","yard.earthsolution.org","ysb.purpledaily.com"]
			
		if datastore['DNS_SERVER']
			@res.nameservers = datastore['DNS_SERVER']
		end
		
		count = 0
		
		while count < datastore['COUNT']
		
			domain.each do |name|
				query = @res.query(name, "A")
				time = Time.new
				time = time.strftime("%Y-%m-%d %H:%M:%S")
				print_status("#{time} - DNS Query sent for => #{name}")
				if query.answer.length == 0
					print_error("#{time} - #{name} => No Record Found")
				else
					a = query.answer[0].to_s.split(/[\s,]+/)
					print_good("#{time} - #{name} => #{a[-1]}")
				end
			end
			unless count == (datastore['COUNT'] - 1)
				time = Time.new
				time = time.strftime("%Y-%m-%d %H:%M:%S")
				print_status("#{time} - Waiting #{datastore['DELAY']} seconds to query")
				select(nil, nil, nil, datastore['DELAY'])
			end
			count += 1
		end
	end
end

